Error while loading conda entry point: conda-libmamba-solver (libarchive.so.20: cannot open shared object file: No such file or directory)
[NbConvertApp] Converting notebook csng/brainreader_mouse/resnet_inversion.ipynb to notebook
Traceback (most recent call last):
  File "/home/vanousek/miniconda3/envs/csng/bin/jupyter-nbconvert", line 11, in <module>
    sys.exit(main())
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/jupyter_core/application.py", line 283, in launch_instance
    super().launch_instance(argv=argv, **kwargs)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/traitlets/config/application.py", line 1075, in launch_instance
    app.start()
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/nbconvertapp.py", line 420, in start
    self.convert_notebooks()
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/nbconvertapp.py", line 597, in convert_notebooks
    self.convert_single_notebook(notebook_filename)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/nbconvertapp.py", line 563, in convert_single_notebook
    output, resources = self.export_single_notebook(
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/nbconvertapp.py", line 487, in export_single_notebook
    output, resources = self.exporter.from_filename(
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/exporters/exporter.py", line 201, in from_filename
    return self.from_file(f, resources=resources, **kw)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/exporters/exporter.py", line 220, in from_file
    return self.from_notebook_node(
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/exporters/notebook.py", line 36, in from_notebook_node
    nb_copy, resources = super().from_notebook_node(nb, resources, **kw)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/exporters/exporter.py", line 154, in from_notebook_node
    nb_copy, resources = self._preprocess(nb_copy, resources)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/exporters/exporter.py", line 353, in _preprocess
    nbc, resc = preprocessor(nbc, resc)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/preprocessors/base.py", line 48, in __call__
    return self.preprocess(nb, resources)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/preprocessors/execute.py", line 103, in preprocess
    self.preprocess_cell(cell, resources, index)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbconvert/preprocessors/execute.py", line 124, in preprocess_cell
    cell = self.execute_cell(cell, index, store_history=True)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
    return future.result()
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbclient/client.py", line 1058, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/home/vanousek/miniconda3/envs/csng/lib/python3.10/site-packages/nbclient/client.py", line 914, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
import matplotlib.pyplot as plt

def evaluate_partial_model(model, test_loader, device, percentage=0.1):
    model.eval()
    test_loss = 0.0
    criterion = nn.MSELoss()
    all_targets = []
    all_predictions = []

    num_batches = int(len(test_loader) * percentage)  # Calculate the number of batches to process
    processed_batches = 0

    with torch.no_grad():
        for grayscale_img, features, target in tqdm(test_loader):
            if processed_batches >= num_batches:
                break

            features = features.to(device)
            target = target.view(target.size(0), -1).to(device)

            # Flatten features
            # Predict
            predictions = model(features)
            loss = criterion(predictions, target)
            test_loss += loss.item()

            # Store for plotting
            all_targets.append(target.cpu())
            all_predictions.append(predictions.cpu())

            processed_batches += 1

    test_loss /= processed_batches
    all_targets = torch.cat(all_targets, dim=0)
    all_predictions = torch.cat(all_predictions, dim=0)

    return test_loss, all_targets, all_predictions

# Evaluate on the first 10% of the test dataset
test_loss_partial, partial_targets, partial_predictions = evaluate_partial_model(
    mlp_model, test_loader, device, percentage=0.1
)
print(f"Test Loss (First 10%): {test_loss_partial:.4f}")

# Plot Examples
def plot_examples(targets, predictions, num_examples=5):
    plt.figure(figsize=(15, num_examples * 3))
    for i in range(num_examples):
        plt.subplot(num_examples, 2, 2 * i + 1)
        plt.imshow(targets[i].reshape(36, 64), cmap='gray')
        plt.title("Actual Target")
        plt.axis('off')

        plt.subplot(num_examples, 2, 2 * i + 2)
        plt.imshow(predictions[i].reshape(36, 64), cmap='gray')
        plt.title("Predicted Target")
        plt.axis('off')
    plt.tight_layout()
    plt.show()

# Plot Examples
num_examples = 5  # Number of examples to visualize
plot_examples(partial_targets[:num_examples].cpu().numpy(), partial_predictions[:num_examples].cpu().numpy())

------------------

----- stderr -----
  0%|          | 0/4 [00:00<?, ?it/s]
----- stderr -----
  0%|          | 0/4 [00:13<?, ?it/s]
----- stderr -----

------------------

[0;31m---------------------------------------------------------------------------[0m
[0;31mZeroDivisionError[0m                         Traceback (most recent call last)
Cell [0;32mIn[6], line 40[0m
[1;32m     37[0m     [38;5;28;01mreturn[39;00m test_loss, all_targets, all_predictions
[1;32m     39[0m [38;5;66;03m# Evaluate on the first 10% of the test dataset[39;00m
[0;32m---> 40[0m test_loss_partial, partial_targets, partial_predictions [38;5;241m=[39m [43mevaluate_partial_model[49m[43m([49m
[1;32m     41[0m [43m    [49m[43mmlp_model[49m[43m,[49m[43m [49m[43mtest_loader[49m[43m,[49m[43m [49m[43mdevice[49m[43m,[49m[43m [49m[43mpercentage[49m[38;5;241;43m=[39;49m[38;5;241;43m0.1[39;49m
[1;32m     42[0m [43m)[49m
[1;32m     43[0m [38;5;28mprint[39m([38;5;124mf[39m[38;5;124m"[39m[38;5;124mTest Loss (First 10%): [39m[38;5;132;01m{[39;00mtest_loss_partial[38;5;132;01m:[39;00m[38;5;124m.4f[39m[38;5;132;01m}[39;00m[38;5;124m"[39m)
[1;32m     45[0m [38;5;66;03m# Plot Examples[39;00m

Cell [0;32mIn[6], line 33[0m, in [0;36mevaluate_partial_model[0;34m(model, test_loader, device, percentage)[0m
[1;32m     29[0m         all_predictions[38;5;241m.[39mappend(predictions[38;5;241m.[39mcpu())
[1;32m     31[0m         processed_batches [38;5;241m+[39m[38;5;241m=[39m [38;5;241m1[39m
[0;32m---> 33[0m test_loss [38;5;241m/[39m[38;5;241m=[39m processed_batches
[1;32m     34[0m all_targets [38;5;241m=[39m torch[38;5;241m.[39mcat(all_targets, dim[38;5;241m=[39m[38;5;241m0[39m)
[1;32m     35[0m all_predictions [38;5;241m=[39m torch[38;5;241m.[39mcat(all_predictions, dim[38;5;241m=[39m[38;5;241m0[39m)

[0;31mZeroDivisionError[0m: float division by zero

